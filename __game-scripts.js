var Scroll=pc.createScript("scroll");Scroll.attributes.add("wheelSensitivity",{type:"number",default:.3,title:"Wheel Sensitivity"}),Scroll.attributes.add("touchSensitivity",{type:"number",default:.1,title:"Touch Sensitivity"}),Scroll.attributes.add("touchParallax",{type:"number",default:1,title:"Touch Parallax"}),Scroll.attributes.add("mouseParallax",{type:"number",default:1,title:"Mouse Parallax"}),Scroll.attributes.add("gridSpeed",{type:"number",default:1}),Scroll.attributes.add("itemsEntity",{type:"entity"}),Scroll.attributes.add("cameraEntity",{type:"entity"}),Scroll.attributes.add("positionMax",{type:"number",default:100}),Scroll.prototype.initialize=function(){var t=this;this._position=12,this._positionVisual=-20,this.mouse=new pc.Vec2,this.vec2A=new pc.Vec2,this.vec2B=new pc.Vec2,this.vec3A=new pc.Vec3,this.vec3B=new pc.Vec3,this.quatA=new pc.Quat,this.size=new pc.Vec2,this.gridTransform=new Float32Array([1,1,0,0]),this.cameraOffset=new pc.Vec2,this.gridMaterials=this.app.assets.findByTag("grid"),this.app.mouse.on("mousewheel",this.onMouseWheel,this),window.addEventListener("mousemove",function(i){t.mouse.x=i.clientX,t.mouse.y=i.clientY},!1),this.scrolled=!1,this.touchId=null,this.touch=new pc.Vec2,this.touchLast=new pc.Vec2,this.touchCurrent=new pc.Vec2,this.orientationLast=new pc.Quat,this.orientationCurrent=new pc.Quat,window.addEventListener("touchstart",function(i){if(!t.touchId)for(var e=0;e<i.changedTouches.length;e++){var s=i.changedTouches[e];t.touchId=s.identifier,t.touchLast.set(s.clientX,s.clientY),t.touchCurrent.copy(t.touchLast);break}}),window.addEventListener("touchmove",function(i){for(var e=0;e<i.changedTouches.length;e++){var s=i.changedTouches[e];if(s.identifier===t.touchId){t.touchCurrent.set(s.clientX,s.clientY);break}}}),window.addEventListener("touchend",function(i){for(var e=0;e<i.changedTouches.length;e++){if(i.changedTouches[e].identifier===t.touchId){t.touchId=null;break}}}),window.addEventListener("deviceorientation",function(i){t.orientationCurrent.setFromEulerAngles(i.beta,i.alpha,i.gamma)},!0);var i=function(){t.size.x=window.innerWidth,t.size.y=window.innerHeight};this.app.graphicsDevice.on("resizecanvas",i),setInterval(i,500)},Scroll.prototype.onMouseWheel=function(t){this._position+=t.wheel*-this.wheelSensitivity,this.scrolled=!0},Scroll.prototype.update=function(t){t||(t=1/60);var i=Math.max(.2,Math.min(5,1/60/t));if(null!==this.touchId?(this.touch.copy(this.touchLast).sub(this.touchCurrent),this.touchLast.copy(this.touchCurrent)):(0!==this.touch.x||0!==this.touch.y)&&this.touch.length()<.01?this.touch.scale(.7):this.touch.set(0,0),0!==this.touch.y&&(this._position-=this.touch.y*-this.touchSensitivity*t,this.scrolled=!0),this._position<0&&(this._position=0),this._position>this.positionMax&&(this._position=this.positionMax),this._positionVisual!==this._position){!this.scrolled&&this._positionVisual<12&&12===this._position&&(i*=1+20*(1-(this._positionVisual+20)/32)),this._positionVisual+=(this._position-this._positionVisual)*Math.max(0,Math.min(1,.1/i)),Math.abs(this._positionVisual-this._position)<.01&&(this._positionVisual=this._position),this.itemsEntity.setLocalPosition(0,0,this._positionVisual);for(var e=0;e<this.gridMaterials.length;e++){var s=this.gridMaterials[e].resource;s.diffuseMapTransform&&(s.offsetDiffuse||(s.offsetDiffuse=new Float32Array([s.diffuseMapTransform.x,s.diffuseMapTransform.y,0,0])),s.offsetDiffuse[3]=this._positionVisual*s.diffuseMapTransform.x/100*this.gridSpeed,s.setParameter("texture_diffuseMapTransform",s.offsetDiffuse))}}this.vec2A.set(0,0);var o=Date.now();this.vec2A.x+=2*Math.sin(o/3e3),this.vec2A.y+=2*Math.cos(o/3100),this.app.touch||0===this.mouse.x||0===this.mouse.y||(this.vec2A.copy(this.mouse),this.vec2B.copy(this.size).scale(.5),this.vec2A.sub(this.vec2B),this.vec2A.scale(-.001*this.mouseParallax)),this.cameraOffset.lerp(this.cameraOffset,this.vec2A,3*t),this.cameraEntity.setLocalEulerAngles(this.cameraOffset.y+7,this.cameraOffset.x,0),this.cameraEntity.setLocalPosition(.1*this.cameraOffset.x,3.5-.1*this.cameraOffset.y,0)};var Fog=pc.createScript("fog");Fog.attributes.add("near",{type:"number",default:0}),Fog.attributes.add("far",{type:"number",default:100}),Fog.prototype.initialize=function(){this.app.scene.fog=pc.FOG_LINEAR,this.app.scene.fogStart=this.near,this.app.scene.fogEnd=this.far,this.on("attr:near",function(t){this.app.scene.fogStart=this.near}),this.on("attr:far",function(t){this.app.scene.fogEnd=this.far})};var Fader=pc.createScript("fader");Fader.attributes.add("fadeNear",{type:"number",default:4}),Fader.attributes.add("fadeWidthNear",{type:"number",default:4}),Fader.attributes.add("fadeFar",{type:"number",default:46}),Fader.attributes.add("fadeWidth",{type:"number",default:8}),Fader.prototype.initialize=function(){this.position=Math.abs(this.entity.getPosition().z),this.opacity=0,this.eachChild(this),this.entity.forEach(this.eachChild,this)},Fader.prototype.update=function(t){var i=this.app.scene.root.script.scroll._positionVisual,a=Math.max(0,Math.min(1,(this.position-this.fadeNear-i)/this.fadeWidthNear)),e=Math.max(0,Math.min(1,(i-(this.position-this.fadeFar))/this.fadeWidth))*a;e>1&&(e=1),e<0&&(e=0),this.opacity!==e&&(this.opacity=e,this.eachChild(this),this.entity.forEach(this.eachChild,this))},Fader.prototype.eachChild=function(t){t.element&&(t.element.opacity=this.opacity),t.sprite&&(t.sprite.opacity=this.opacity)};var Slider=pc.createScript("slider");Slider.attributes.add("offsetPosition",{type:"vec2",default:[0,0]}),Slider.attributes.add("offsetDistance",{type:"number",default:46}),Slider.attributes.add("offsetWidth",{type:"number",default:8}),Slider.prototype.initialize=function(){this.position=Math.abs(this.entity.getPosition().z),this.positionInitial=this.entity.getLocalPosition().clone(),this.vec3=new pc.Vec3,this.offset=0},Slider.prototype.update=function(t){var i=this.app.scene.root.script.scroll._positionVisual,e=1-Math.max(0,Math.min(1,Math.abs((this.position-this.offsetDistance-i)/this.offsetWidth)));this.offset!==e&&(this.vec3.x=this.offsetPosition.x,this.vec3.y=this.offsetPosition.y,this.vec3.scale(e).add(this.positionInitial),this.entity.setLocalPosition(this.vec3))};var Video=pc.createScript("video");Video.attributes.add("width",{type:"number",default:1}),Video.attributes.add("height",{type:"number",default:1}),Video.attributes.add("frames",{type:"number",default:1}),Video.attributes.add("fps",{type:"number",default:10}),Video.prototype.initialize=function(){this.vec4A=new pc.Vec4(0,0,1,1),this.frame=-1},Video.prototype.update=function(t){if(!this.loading&&this.entity.getPosition().z>-48&&this.entity.getPosition().z<0){var e=Math.floor(Date.now()/(1e3/this.fps))%this.frames;if(this.frame!==e){this.frame=e;var i=e%this.width*(1/this.width),h=Math.floor(e/this.width)*(1/this.height);if(this.entity.element.texture){var s=2/this.entity.element.texture.width;this.vec4A.x=i+s,this.vec4A.y=1-1/this.height-h+s,this.vec4A.z=1/this.width-2*s,this.vec4A.w=1/this.height-2*s,this.entity.element.rect=this.vec4A}}}};var Hamburger=pc.createScript("hamburger");Hamburger.attributes.add("line",{type:"entity"}),Hamburger.attributes.add("buttons",{type:"entity"}),Hamburger.attributes.add("closeDelay",{type:"number",default:3e3}),Hamburger.prototype.initialize=function(){this.open=!1,this.state=1,this.stateLast=0,this.interacted=0,this.entity.element.on("click",function(){this.open=!this.open,this.interacted=Date.now()},this),this.app.on("hamburger:interact",function(){this.interacted=Date.now()},this),this.lineHeight=this.line.element.height,this.currentButton=null,this.buttonsSorted=this.buttons.children.sort(function(t,e){return t.script.sectionButton.position-e.script.sectionButton.position})},Hamburger.prototype.update=function(t){var e=!1,i=Math.max(.2,Math.min(5,1/60/t));if(this.open&&Date.now()-this.interacted>this.closeDelay&&(this.open=!1),this.open&&1!==this.state?(this.state+=(1-this.state)*(.2*i),e=!0,this.state>.99&&(this.state=1)):this.open||0===this.state||(this.state+=(0-this.state)*(.3*i),e=!0,this.state<.01&&(this.state=0)),e||0===t){this.line.element.height=this.lineHeight*this.state;for(var s=0;s<this.buttons.children.length;s++){var n=Math.max(0,Math.min(1,10*this.state-s/this.buttons.children.length*10));this.buttons.children[s].element.opacity=n,this.buttons.children[s].children[0].element.opacity=n}if(0===this.state){this.line.enabled=!1;for(s=0;s<this.buttons.children.length;s++)this.buttons.children[s].enabled=!1}else if(0===this.stateLast){this.line.enabled=!0;for(s=0;s<this.buttons.children.length;s++)this.buttons.children[s].enabled=!0}this.stateLast=this.state}if(0!==this.state){var h=this.app.scene.root.script.scroll._positionVisual,o=this.buttonsSorted[0];for(s=1;s<this.buttonsSorted.length;s++){var r=this.buttonsSorted[s-1].script.sectionButton.position,a=this.buttonsSorted[s].script.sectionButton.position;if(a-(a-r)/2>+h)break;o=this.buttonsSorted[s]}this.currentButton!==o&&(this.currentButton&&(this.currentButton.script.sectionButton.active=!1),this.currentButton=o,this.currentButton.script.sectionButton.active=!0)}};var SectionButton=pc.createScript("sectionButton");SectionButton.attributes.add("position",{type:"number"}),SectionButton.attributes.add("hoverColor",{type:"rgb"}),SectionButton.attributes.add("normalColor",{type:"rgb"}),SectionButton.prototype.initialize=function(){this._active=!1,this.state=0,this.entity.element.on("mouseenter",function(){this.entity.children[0].element.color=this.hoverColor},this),this.entity.element.on("mouseleave",function(){this._active||(this.entity.children[0].element.color=this.normalColor)},this),this.entity.element.on("click",function(){this.app.scene.root.script.scroll._position=this.position,this.app.fire("hamburger:interact")},this)},SectionButton.prototype.update=function(t){var e=!1,i=Math.max(.2,Math.min(5,1/60/t));this._active&&1!==this.state?(this.state+=(1-this.state)*(.2*i),e=!0,this.state>.99&&(this.state=1)):this._active||0===this.state||(this.state+=(0-this.state)*(.3*i),e=!0,this.state<.01&&(this.state=0)),e&&(this.entity.children[0].element.fontSize=32*this.state+24*(1-this.state))},Object.defineProperty(SectionButton.prototype,"active",{get:function(){return this._active},set:function(t){if(this._active!==t){this._active=t;var e=this.entity.children[0].element;this._active?(e.color=this.hoverColor,e.fontSize=32):(e.color=this.normalColor,e.fontSize=24)}}});pc.extend(pc,function(){var e=function(e,t,r){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:t,fshader:r.replace("%precision%",e.precision)})};return(e=pc.inherits(e,pc.PostEffect)).prototype=pc.extend(e.prototype,{render:function(e,t,r){var i=this.device,s=i.scope;s.resolve("uColorBuffer").setValue(e.colorBuffer),s.resolve("uLut").setValue(this.textureLut.resource),s.resolve("uVignette").setValue(this.textureVignette.resource),s.resolve("resolution").setValue(this.resolution),s.resolve("abberation").setValue(this.abberation),pc.drawFullscreenQuad(i,t,this.vertexBuffer,this.shader,r)}}),{LutEffect:e}}());var Lut=pc.createScript("lut");Lut.attributes.add("textureLut",{type:"asset",assetType:"texture",title:"LUT Texture"}),Lut.attributes.add("textureVignette",{type:"asset",assetType:"texture",title:"Vignette Texture"}),Lut.attributes.add("shaderVert",{type:"asset",assetType:"shader",title:"Vertex Shader"}),Lut.attributes.add("shaderFrag",{type:"asset",assetType:"shader",title:"Fragment Shader"}),Lut.attributes.add("abberation",{type:"number",default:10,title:"Abberation Factor"}),pc.PostEffectQueue.prototype._createOffscreenTarget=function(e,t){var r=this.camera.rect,i=Math.floor(r.z*this.app.graphicsDevice.width*this.renderTargetScale),s=Math.floor(r.w*this.app.graphicsDevice.height*this.renderTargetScale),a=this.app.graphicsDevice,c=t?a.getHdrFormat():pc.PIXELFORMAT_R8_G8_B8_A8,h=this.app.graphicsDevice.supportsStencil,u=new pc.Texture(a,{format:c,width:i,height:s});return u.name="posteffect #"+this.effects.length,u.minFilter=pc.FILTER_NEAREST,u.magFilter=pc.FILTER_NEAREST,u.addressU=pc.ADDRESS_CLAMP_TO_EDGE,u.addressV=pc.ADDRESS_CLAMP_TO_EDGE,new pc.RenderTarget(this.app.graphicsDevice,u,{depth:e,stencil:h,samples:4})},Lut.prototype.initialize=function(){this.effect=new pc.LutEffect(this.app.graphicsDevice,this.shaderVert.resource,this.shaderFrag.resource),this.effect.textureLut=this.textureLut,this.effect.textureVignette=this.textureVignette,this.effect.resolution=new Float32Array([this.app.graphicsDevice.width,this.app.graphicsDevice.height]),this.effect.abberation=this.abberation,this.app.graphicsDevice.on("resizecanvas",function(e,t){this.effect.resolution[0]=e,this.effect.resolution[1]=t},this),this.on("attr:textureLut",function(e){this.effect.textureLut=e}),this.on("attr:textureVignette",function(e){this.effect.textureVignette=e}),this.on("attr:abberation",function(e){this.effect.abberation=e});var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};var Loader=pc.createScript("loader");Loader.attributes.add("spinner_1",{type:"asset",assetType:"texture"}),Loader.attributes.add("spinner_2",{type:"asset",assetType:"texture"}),Loader.attributes.add("spinner_0_5",{type:"asset",assetType:"texture"}),Loader.prototype.initialize=function(){for(var e=this,t=this.app.assets.findByTag("loadFirst"),i=0;i<t.length;i++)t[i].resource||this.app.assets.load(t[i]);var s={},n=this.app.assets.findByTag("postLoad");for(i=0;i<n.length;i++)s[n[i].id]=n[i];this.app.scene.root.forEach(function(t){if(t.element&&t.element._image&&t.element._image._textureAsset){var i=s[t.element._image._textureAsset];if(i)if(i.resource);else{var n=t.element.width/t.element.height,r=null,a=1,o=t.element.width,p=t.element.height,l=t.element.rect.clone();n>1?(r=e.spinner_2,a=.5):n<1?(r=e.spinner_0_5,a=2):(r=e.spinner_1,a=1),t.script&&t.script.video&&(t.script.video.loading=!0,t.element.rect=new pc.Vec4(0,0,1,1)),t.element.texture=r.resource,t.element.width*a>t.element.height?t.element.width=t.element.height/a:t.element.height=t.element.width*a,i.once("load",function(){t.element.texture=i.resource,t.element.width=o,t.element.height=p,t.script&&t.script.video&&(t.script.video.loading=!1,t.element.rect=l)}),e.app.assets.load(i)}}})},Loader.prototype.postInitialize=function(){},Loader.prototype.update=function(){};pc.extend(pc,function(){var e=15;function computeGaussian(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function calculateBlurValues(t,s,r,o,i){t[0]=computeGaussian(0,i),s[0]=0,s[1]=0;var a,l,u=t[0];for(a=0,l=Math.floor(e/2);a<l;a++){var h=computeGaussian(a+1,i);t[2*a]=h,t[2*a+1]=h,u+=2*h;var n=2*a+1.5;s[4*a]=r*n,s[4*a+1]=o*n,s[4*a+2]=-r*n,s[4*a+3]=-o*n}for(a=0,l=t.length;a<l;a++)t[a]/=u}var t=function(t){var s={aPosition:pc.SEMANTIC_POSITION},r=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join("\n"),o=["precision "+t.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),i=["precision "+t.precision+" float;","","#define SAMPLE_COUNT "+e,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),a=["precision "+t.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=new pc.Shader(t,{attributes:s,vshader:r,fshader:o}),this.blurShader=new pc.Shader(t,{attributes:s,vshader:r,fshader:i}),this.combineShader=new pc.Shader(t,{attributes:s,vshader:r,fshader:a});var l=t.width,u=t.height;this.targets=[];for(var h=0;h<2;h++){var n=new pc.Texture(t,{format:pc.PIXELFORMAT_R8_G8_B8_A8,width:l>>1,height:u>>1});n.minFilter=pc.FILTER_LINEAR,n.magFilter=pc.FILTER_LINEAR,n.addressU=pc.ADDRESS_CLAMP_TO_EDGE,n.addressV=pc.ADDRESS_CLAMP_TO_EDGE;var f=new pc.RenderTarget(t,n,{depth:!1});this.targets.push(f)}this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(e),this.sampleOffsets=new Float32Array(2*e)};return(t=pc.inherits(t,pc.PostEffect)).prototype=pc.extend(t.prototype,{render:function(e,t,s){var r=this.device,o=r.scope;o.resolve("uBloomThreshold").setValue(this.bloomThreshold),o.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(r,this.targets[0],this.vertexBuffer,this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),o.resolve("uBlurWeights[0]").setValue(this.sampleWeights),o.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),o.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),pc.drawFullscreenQuad(r,this.targets[1],this.vertexBuffer,this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),o.resolve("uBlurWeights[0]").setValue(this.sampleWeights),o.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),o.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),pc.drawFullscreenQuad(r,this.targets[0],this.vertexBuffer,this.blurShader),o.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),o.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),o.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(r,t,this.vertexBuffer,this.combineShader,s)}}),{BloomEffect:t}}());var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,precision:2,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new pc.BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",function(e,t){this.effect[e]=t},this),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};var RestartButton=pc.createScript("restartButton");RestartButton.prototype.initialize=function(){this.entity.element.on("click",function(){this.app.scene.root.script.scroll._position=0},this)};var VideoPlayer=pc.createScript("videoPlayer");VideoPlayer.attributes.add("html",{type:"asset",assetType:"html"}),VideoPlayer.attributes.add("css",{type:"asset",assetType:"css"}),VideoPlayer.attributes.add("url",{type:"string"}),VideoPlayer.prototype.initialize=function(){this.elementCss=document.createElement("style"),this.templateCss(this.css.resource||""),document.head.appendChild(this.elementCss),this.element=document.createElement("div"),this.element.id="videoPlayer",this.element.innerHTML=this.html.resource||"",document.body.appendChild(this.element),this.css.on("load",function(){this.templateCss(this.css.resource||"")},this),this.iframe=this.element.querySelector("iframe"),this.active=!1},VideoPlayer.prototype.replaceTags=function(e){for(var t=this.app,i=e.match(/\{.+?\}/g),s=0;s<i.length;s++){var a=i[s].match(/\{asset\[(.+?)\]\.(.+?)\}/i);if(a){var r=a[1],l=a[2].split("."),n=t.assets.findByTag(r);if(!n||!n.length){console.error("Could not find asset with tag "+r);continue}for(var o=n[0],h=0;h<l.length;h++)o="function"==typeof o[l[h]]?o[l[h]].call(o):o[l[h]];e=e.replace(i[s],o)}}return e},VideoPlayer.prototype.templateCss=function(e){this.elementCss.innerHTML=this.replaceTags(e)},VideoPlayer.prototype.update=function(e){this.active||0===this.entity.script.fader.opacity?this.active&&0===this.entity.script.fader.opacity&&(this.active=!1,this.player.pause(),this.app.fire("sound:unmute"),this.element.classList.remove("active")):(this.active=!0,this.iframe.src||(this.iframe.src=this.url,this.player=new Vimeo.Player(this.iframe)),this.player.play(),this.app.fire("sound:mute"),this.element.classList.add("active"))};var SoundToggle=pc.createScript("soundToggle");SoundToggle.prototype.initialize=function(){this.playing=!0,this.state=1,this.music=this.entity.sound.slots.music,this.silence=!1,this.entity.element.on("click",function(){this.playing?(this.playing=!1,this.entity.element.spriteFrame=1):(this.playing=!0,this.entity.element.spriteFrame=0)},this),this.app.on("sound:mute",function(){this.silence=!0},this),this.app.on("sound:unmute",function(){this.silence=!1},this)},SoundToggle.prototype.update=function(t){var i=!1,s=Math.max(.2,Math.min(5,1/60/t));this.playing&&!this.silence&&1!==this.state?(0===this.state&&this.music.resume(),this.state+=(1-this.state)*(.1*s),i=!0,this.state>.99&&(this.state=1)):this.playing&&!this.silence||0===this.state||(this.state+=(0-this.state)*(.1*s),i=!0,this.state<.01&&(this.state=0)),i&&(this.music.volume=this.state,0===this.state&&this.music.pause())};var FaceLine=pc.createScript("faceLine");FaceLine.attributes.add("emissiveShaderVert",{type:"asset",assetType:"shader"}),FaceLine.attributes.add("emissiveShader",{type:"asset",assetType:"shader"}),FaceLine.prototype.initialize=function(){this.transform=new Float32Array([1,1,0,0]),this.material=this.entity.model.meshInstances[0].material,this.material.chunks.uv0VS=this.emissiveShaderVert.resource,this.material.chunks.emissivePS=this.emissiveShader.resource,this.material.update(),this.emissiveShader.on("load",function(){this.material.chunks.emissivePS=this.emissiveShader.resource,this.material.update()},this),this.emissiveShaderVert.on("load",function(){this.material.chunks.uv0VS=this.emissiveShaderVert.resource,this.material.update(),console.log(this.material.shader.definition)},this)},FaceLine.prototype.update=function(e){this.transform[2]=(this.transform[2]+e/2)%1,this.material.setParameter("texture_emissiveMapTransform",this.transform)};var ScrollText=pc.createScript("scrollText");ScrollText.attributes.add("html",{type:"asset",assetType:"html"}),ScrollText.attributes.add("content",{type:"asset",assetType:"html"}),ScrollText.attributes.add("visibleTill",{type:"entity"}),ScrollText.attributes.add("styleName",{type:"string"}),ScrollText.prototype.initialize=function(){this.element=document.createElement("div"),this.element.classList.add("scrollText",this.styleName),this.element.innerHTML=this.html&&this.html.resource||"",this.contentElement=this.element.querySelector(".content"),this.contentElement&&(this.contentElement.innerHTML=this.content&&this.content.resource||""),document.body.appendChild(this.element),this.positionFrom=Math.abs(this.entity.getPosition().z)-24,this.positionTo=Math.abs(this.visibleTill.getPosition().z),this.state=!1},ScrollText.prototype.update=function(){var t=this.app.scene.root.script.scroll._positionVisual;if(!this.state&&t>this.positionFrom&&t<this.positionTo?(this.state=!0,this.element.classList.add("active")):this.state&&(t<this.positionFrom||t>this.positionTo)&&(this.state=!1,this.element.classList.remove("active")),this.state){var e=(t-this.positionFrom)/(this.positionTo-this.positionFrom),i=(this.contentElement.scrollHeight-this.contentElement.clientHeight+1e3)*e-500;this.contentElement.scrollTop=i}};